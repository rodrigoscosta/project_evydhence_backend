# Use uma imagem base do Python
FROM python:3.12-slim

# Instale as dependências do sistema necessárias para o mysqlclient
RUN apt-get update && apt-get install -y \
    build-essential \
    default-libmysqlclient-dev \
    libssl-dev \
    libffi-dev \
    libmariadb-dev-compat \
    libmariadb-dev \
    pkg-config

# Defina o diretório de trabalho
WORKDIR /app

# Copie o arquivo de requisitos para instalar as dependências do projeto
COPY requirements.txt .

# Instale as dependências do Python
RUN pip install --upgrade pip && pip install -r requirements.txt

# Copie o código da aplicação para o contêiner
COPY . .

# Defina variáveis de ambiente, se necessário
ENV MYSQLCLIENT_CFLAGS="-I/usr/include/mysql"
ENV MYSQLCLIENT_LDFLAGS="-L/usr/lib/mysql"

# Execute os comandos de migração do Django
RUN python manage.py migrate

# Exponha a porta que o Django usará
EXPOSE 8000

# Comando para iniciar o servidor do Django
CMD ["python", "manage.py", "runserver", "0.0.0.0:8000"]